<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<template id="fn-dropdown-base-tpl">
  <style>
    select.disabled {
      opacity: 0.5;
    }
  </style>
  <select></select>
</template>
<script type="text/javascript">
  var DropDownComponent = function() {
    this.createdCallback = function() {
      var shadow = this.createShadowRoot();
      var tpl = Fnord.getTemplate("fn-dropdown", "base");
      shadow.appendChild(tpl);

      var base = this;

      var select = this.shadowRoot.querySelector("select");
      select.addEventListener('change', function(e) {
        base.fireSelectEvent();
      }, false);

      this.attributeChangedCallback();
    }

    this.attributeChangedCallback = function(attr, old_val, new_val) {
      if (attr == "disabled") {
        this.handleDisableAttr(new_val);
      }
    };

    this.handleDisableAttr = function(val) {
      var select = this.shadowRoot.querySelector("select");
      if (val == "disabled") {
        select.disabled = true;
        select.className = "disabled";
      } else {
        select.disabled = false;
        select.className = "";
      }
    };

    this.setOptions = function(options) {
      var select = this.shadowRoot.querySelector("select");
      options.map(function(o) {
        var option_elem = document.createElement("option");
        option_elem.innerHTML = o
        select.appendChild(option_elem);
      });
    };

    this.setValue = function(value) {
      var select = this.shadowRoot.querySelector("select");
      select.value = value;
    };

    this.getValue = function() {
      var select = this.shadowRoot.querySelector("select");
      return select.value;
    };

    this.fireSelectEvent = function() {
      this.dispatchEvent(new Event("fn-dropdown-select"));
    }

    /*
    setAllValues
    setDisplayValue
    getDisplayValue
    */

  };

  window.addEventListener("fn-ready", function() {
    Fnord.registerComponent("fn-dropdown", DropDownComponent);
  }, false);
</script>
