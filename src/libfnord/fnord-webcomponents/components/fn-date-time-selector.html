<!--
  This file is part of the "FnordMetric" project
    Copyright (c) 2014 Laura Schlimmer
    Copyright (c) 2014 Paul Asmuth, Google Inc.

  FnordMetric is free software: you can redistribute it and/or modify it under
  the terms of the GNU General Public License v3.0. You should have received a
  copy of the GNU General Public License along with this program. If not, see
  <http://www.gnu.org/licenses/>.
-->
<style type='text/css'>
  fn-date-time-selector {
    display: block;
  }
</style>
<template id='fn-date-time-selector-base-tpl'>
  <style type='text/css'>
    .wrapper * {
      float: left;
    }

    fn-calendar {
      display: none;
    }

    fn-calendar.active {
      display: block;
    }
  </style>

  <div class="wrapper">
    <i class="fa fa-chevron-left"></i>
    <div class="dropdown" id="range"></div>
    <div id="picker">
      <b id="endtime_descr"></b>
      <i class="fa fa-caret-down"></i>
      <fn-calendar data-style='small' data-selectable='past'></fn-calendar>
    </div>
    <i class="fa fa-chevron-right"></i>
  </div>
</template>
<script type='text/javascript'>
  var DateTimeSelector = function() {
    this.createdCallback = function() {
      var shadow = this.createShadowRoot();
      var tpl = Fnord.getTemplate('fn-date-time-selector', 'base');
      shadow.appendChild(tpl);

      if (this.getAttribute('data-resolved') == 'resolved') {
        this.render();
      }
    }

    this.render = function() {
      var dropdown = this.querySelector("fn-dropdown");
      var picker = this.shadowRoot.getElementById("picker");
      var calendar = this.shadowRoot.querySelector("fn-calendar");

      var date_range = this.getAttribute('data-range');
      var until = this.getAttribute('data-until');

      date_range = date_range ? date_range : 900;
      until = until ? new Date(until) : new Date();

      dropdown.setAttribute('data-preselected', date_range);
      this.shadowRoot.getElementById('range').appendChild(dropdown);

      calendar.setAttribute('data-selected', until.getTime());
    }

  };

  window.addEventListener('fn-ready', function() {
    Fnord.registerComponent('fn-date-time-selector', DateTimeSelector);
  }, false);
</script>
